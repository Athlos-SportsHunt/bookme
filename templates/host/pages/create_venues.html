{% extends 'host/base.html' %}
{% load static %}

{% block title %}Create Venue{% endblock %}

{% block imports_block %}
<link rel="stylesheet" href="{% static 'css/host/pages/create_venues.css'%}">
{% endblock imports_block %}

{% block content %}
<div class="container">
    <h1>Create a New Venue</h1>
    <form method="post" id="venueForm">
        {% csrf_token %}
        <div class="form-group">
            <label for="venue_name">Venue Name:</label>
            <input 
                type="text" 
                id="venue_name" 
                name="venue_name" 
                required 
                placeholder="Enter venue name"
                minlength="3"
            >
        </div>
        <button type="submit">Create Venue</button>
    </form>
    <div id="successMessage" class="success-message">
        Venue created successfully!
    </div>
    <div id="errorMessage" class="error-message">
        Error creating venue. Please try again.
    </div>
</div>
{% endblock content %}

{% block js_imports %}
<script>
document.getElementById('venueForm').addEventListener('submit', async function(event) {
    event.preventDefault();

    const venueName = document.getElementById('venue_name').value;
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    const response = await fetch('{% url "api:create_venue" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({ venue_name: venueName })
    });

    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');

    successMessage.style.display = 'none';
    errorMessage.style.display = 'none';

    if (response.ok) {
        successMessage.style.display = 'block';
        document.getElementById('venue_name').value = ''; // Clear the input
        setTimeout(() => {
            window.location.href = `{% url 'host:dashboard' %}`;
        }, 2000);
    } else {
        errorMessage.style.display = 'block';
    }
});
</script>
{% endblock js_imports %}
