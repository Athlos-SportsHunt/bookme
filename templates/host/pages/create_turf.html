{% extends 'host/base.html' %}
{% load static %}

{% block title %}Create Turf{% endblock %}

{% block imports_block %}
<link rel="stylesheet" href="{% static 'css/host/pages/create_turf.css'%}">
{% endblock imports_block %}

{% block content %}
<div class="container">
    <h1>Create a New Turf</h1>
    <form id="createTurfForm" method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="turfName">Turf Name:</label>
            <input 
                type="text" 
                id="turfName" 
                name="turf_name" 
                required 
                placeholder="Enter turf name"
            >
            <div class="error-message" id="nameError" style="display: none;">Please enter a valid turf name</div>
        </div>

        <div class="form-group">
            <label for="pricePerHour">Price per Hour ($):</label>
            <input 
                type="number" 
                id="pricePerHour" 
                name="price_per_hr" 
                required 
                min="0" 
                step="0.01" 
                placeholder="Enter price per hour"
            >
            <div class="error-message" id="priceError" style="display: none;">Please enter a valid price</div>
        </div>

        <input type="hidden" id="venueId" name="venue_id" value="{{ venue_id }}">

        <button type="submit" id="submitBtn">Create Turf</button>
    </form>

    <div class="success-message" id="successMessage" style="display: none;">
        Turf created successfully!
    </div>
</div>
{% endblock content %}

{% block js_imports %}
<script>
    document.querySelector('#createTurfForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const turfName = document.getElementById('turfName').value;
        const pricePerHour = document.getElementById('pricePerHour').value;
        const venueId = document.getElementById('venueId').value;

        const nameError = document.getElementById('nameError');
        const priceError = document.getElementById('priceError');
        const successMessage = document.getElementById('successMessage');

        // Reset error messages
        nameError.style.display = 'none';
        priceError.style.display = 'none';
        successMessage.style.display = 'none';

        // Validate inputs
        let valid = true;

        if (!turfName) {
            nameError.style.display = 'block';
            valid = false;
        }

        if (pricePerHour <= 0 || isNaN(pricePerHour)) {
            priceError.style.display = 'block';
            valid = false;
        }

        if (!valid) {
            return;
        }

        try {
            const response = await fetch('{% url "api:create_turf" venue_id %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify({
                    turf_name: turfName,
                    price_per_hr: parseFloat(pricePerHour),
                    venue: parseInt(venueId),
                }),
            });

            if (response.ok) {
                successMessage.style.display = 'block';
                setTimeout(() => {
                    window.location.href = `{% url 'host:venue' venue_id %}`;
                }, 1500);
            } else {
                alert('Failed to create turf. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while creating the turf.');
        }
    });
</script>
{% endblock js_imports %}
